local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Chaoem/Bu/refs/heads/main/Hghhh"))()

local Window = Library:AddWindows()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local aimsilent = false
local aimnearest = false
local selectedPlayer = nil
local targetCFrame, targetPos = nil, nil

-- Avoid double hook
if getgenv().Maru_AimHooked then return end
getgenv().Maru_AimHooked = true

-- âœ… Update Target (Manual)
local function UpdateTargetManual()
    if selectedPlayer then
        local plr = Players:FindFirstChild(selectedPlayer)
        if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            targetCFrame = plr.Character.HumanoidRootPart.CFrame
            targetPos = targetCFrame.Position
            return
        end
    end
    targetCFrame, targetPos = nil, nil
end

-- âœ… Update Target (Nearest)
local function UpdateTargetNearest()
    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then return end
    local closest, closestDist = nil, 2000
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (plr.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closest = plr
            end
        end
    end
    if closest then
        targetCFrame = closest.Character.HumanoidRootPart.CFrame
        targetPos = targetCFrame.Position
    else
        targetCFrame, targetPos = nil, nil
    end
end

-- ðŸ§© Hook Metatable
local mta = getrawmetatable(game)
local original_namecall = mta.__namecall
local original_index = mta.__index
setreadonly(mta, false)

mta.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Skip water damage
    if (method == "FireServer" or method == "InvokeServer") and self.Name == "Drown" and _G.nowaterdamage then
        return nil
    end

    -- Modify FireServer target
    if method == "FireServer" and (aimsilent or aimnearest) and targetPos then
        for i = 1, #args do
            if type(args[i]) == "table" then
                local tbl = args[i]
                if tbl.Mouse_Position or tbl.Hit_Position then
                    if tbl.Mouse_Position then
                        tbl.Mouse_Position = targetPos
                    end
                    if tbl.Hit_Position then
                        tbl.Hit_Position = targetPos
                    end
                    args[i] = tbl
                end
            end
        end
    end

    return original_namecall(self, unpack(args))
end)

mta.__index = newcclosure(function(a, b)
    if tostring(b):lower() == "hit" and (aimsilent or aimnearest) and targetCFrame then
        return targetCFrame
    end
    return original_index(a, b)
end)

setreadonly(mta, true)

-- ðŸŒŸ UI Section (Maru style)
local PlayerTab = Window:AddTab({ Name = "Aimbot" })
local Left = PlayerTab:AddSection("Left", { Name = "Silent Aim Controls" })

-- Toggle 1: Silent AimBot (Manual)
Left:AddToggle({
    Name = "Silent AimBot (Select Player)",
    Default = false,
    Callback = function(v)
        aimsilent = v
        if v then
            spawn(function()
                while aimsilent do
                    pcall(UpdateTargetManual)
                    task.wait(0.05)
                end
            end)
        else
            targetCFrame, targetPos = nil, nil
        end
    end
})

-- Toggle 2: Silent Aim (Nearest)
Left:AddToggle({
    Name = "Silent Aim Nearest (2000 studs)",
    Default = false,
    Callback = function(v)
        aimnearest = v
        if v then
            spawn(function()
                while aimnearest do
                    pcall(UpdateTargetNearest)
                    task.wait(0.05)
                end
            end)
        else
            targetCFrame, targetPos = nil, nil
        end
    end
})

-- ðŸ”½ Player Dropdown (chuáº©n Maru)
local Right = PlayerTab:AddSection("Right", { Name = "Select Target" })

local function GetPlayerList()
    local list = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            table.insert(list, p.Name)
        end
    end
    return list
end

local PlayerDropdown = Right:AddDropdown({
    Name = "Select Player",
    Options = GetPlayerList(),
    Default = GetPlayerList()[1] or "None",
    Callback = function(v)
        selectedPlayer = v
    end
})

-- ðŸ” Button Refresh (Maru Style)
Right:AddButton({
    Name = "Refresh Player List",
    Callback = function()
        local newList = GetPlayerList()
        PlayerDropdown:Refresh(newList)
        Library:AddNotify({
            Title = "Player List",
            Content = "Refreshed Successfully (" .. #newList .. " players)",
            Time = 2
        })
    end
})
